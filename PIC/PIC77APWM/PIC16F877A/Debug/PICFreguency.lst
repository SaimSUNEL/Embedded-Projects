     1: 
     2: #include<htc.h>
     3: #include "c:\\tc\\delay.c"
     4: unsigned int degerler[ 10 ];
     5: char index;
     6: volatile long int freq;
     7: unsigned char seri_porttan_veri_al()
     8: {
     9: while( !RCIF );
    10: return RCREG;
    11: }
    12: void seri_porta_veri_gonder(unsigned char jk)
    13:  { while( !TXIF );
    14:          TXREG=jk;
    15: 
    16:         
    17:          }
    18: void seri_portu_ayarla()
    19: {SPBRG=25; //DIVIDER;
    20:         BRGH=1;
    21:         
    22:         
    23:         SYNC=0;
    24:         
    25:         TX9=0;
    26:         
    27:         TXEN=1;
    28:         
    29:         RX9=0;
    30:         
    31:         CREN=1;
    32:         
    33:         
    34:         
    35:         SPEN=1;/*
    36:         RC6=1;
    37:         
    38:         RC7=1;
    39: */
    40:         }
    41: 
    42: char x ,b=0;
    43: void interrupt FNC ( )
    44: {
    45: 
    46:         degerler[ index++ ] = CCPR1;
    47:         CCP1IF=0;
    48:         if( index==10){index=0;
    49:                 
    50:                 
    51:                 CCP1IE = 0;
    52:         
    53:                 seri_porta_veri_gonder( degerler[ 5 ] - degerler [4]);
    54:                 
    55:                 DelayMs ( 500 );
    56:                 
    57:                 
    58:                                 CCP1IE = 1;
    59:                         
    60:                 
    61:                 
    62:                 }
    63:         }
    64: 
    65: void main()
    66: {
    67:         seri_portu_ayarla();
    68: TRISB = 0;
    69: PORTB = 0;
    70: CCP1M2 = 1;//capture mode on every rising edge...
    71: TMR1 = 0;
    72: TMR1CS = 0;//internal osc / 4
    73: GIE = 1;
    74: PEIE = 1;
    75: CCP1IE = 1;
    76: T1CKPS1 = 0; //Presc 1/4
    77: T1CKPS0 = 0;
    78: TMR1ON = 1;
    79:         
    80:         while( 1 );
    81:         
    82:         
    83:         
    84: }